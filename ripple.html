<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Meta, title, CSS, favicons, etc. -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta property="og:title" content="Ripple">
	<meta property="og:url" content="www.getkefi.com">

	<!--Google Maps and Google Places APIs-->

	<!--<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&key=AIzaSyAWf1WnMo_4s35yeXZ-kZyF-QZ7m5MwqP0"></script>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=true"></script>-->

	<!-- bootstrap -->
	<link type="text/css" href="main.css" rel="stylesheet"/>
	<link rel="shortcut icon" href="http://www.getripple.io/rippleHeaderLogo.png">
	<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<script src="//www.parsecdn.com/js/parse-1.4.2.min.js"></script>
	<script src="http://timeago.yarp.com/jquery.timeago.js"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

	<!--load google fonts!-->
	<link href='http://fonts.googleapis.com/css?family=Roboto:100' rel='stylesheet' type='text/css'>

	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>


	<title>Ripple</title>

	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-49651565-1', 'getkefi.com');
	ga('send', 'pageview');

	</script>
</head>

<body>
	<!--header-->
	<div class="headerTitle" style="padding-bottom:5px;">
		<div style="padding-top:10px;">
			<p class="centerSubtext" align="center" style="color:#fff; font-family: 'Roboto', sans-serif;"><span class="centerText">Ripple</span><br/>explore your world</p>

		</div>
	</div>

	<div class="explanation" style="font-family:'Roboto'; font-size:12px; padding:10px; padding-bottom:10px; background:#ededed; margin: 0 auto;">
		<p align="center"><a href="http://getRipple.io">Ripple</a> lets you explore the world by spreading the most engaging posts to users around the world. Visualize ripples on a map as they travel across the globe. </p>
		<div class="actions" style="margin:0 auto;width:40%;"> 
			<a href="https://itunes.apple.com/us/app/ripple-spread-your-thoughts/id946792245?ls=1&mt=8"><img class="ios" src="Download_on_the_App_Store_Badge_US-UK_135x40.png"></a>&nbsp; &nbsp;
			<a href="https://play.google.com/store/apps/details?id=com.KefiLabs.Ripple"> <img class="android" alt="Get it on Google Play" src="http://i.imgur.com/pWic5cg.png?1" /></a>
		</div>

	</div>

	<div class="ripple" style="padding:10px 5px 20px 5px; margin-top:80px;">

		<div class="innerRipple" style="width:70%; margin:0 auto; padding:50px;">
			<img id="ripple_image" style="margin:0 auto; display:block;" width="50%">
			<div id="ripple_num_propagated" style="margin:0 auto; background:#055a93; height:30px; padding:8px; color:#fff; width:50%">

			</div>
			</br>
			<p id="ripple_text" style="font-size:20px;padding-bottom:50px; padding:8px; width:50%; margin:0 auto;" ></p>
			</br>
			<div  style="margin: 0 auto; width:70%;" class="username">
				<div style="color:#777;"><span style="color:#055a93;"><b id="ripple_creator"></b></span><span id="ripple_location"></span></div>
				<div id="ripple_created_at" style="float:right; color:#777"></div>

			</div>

			<br/>
			<br/>
			<div style="height : 600px; width: 70%; margin:0 auto; padding-top:100px;" id="map-canvas"></div>

			
		</div>

	<br/>
	
	</div>

	


	<!-- foooter -->
	<footer>
		<nav>
			<ul>
				<li>
					<a href="http://getripple.io">home</a>
				</li>
				<li>
					<a href="https://medium.com/@RippleMeThis">blog</a>
				</li>
				<li>
					<a href="ambassador.html">ambassador</a>
				</li>
				<li>
					<a href="ripple_terms.html">terms</a>
				</li>
				<li>
					<a href="ripple_privacy.html">privacy</a>
				</li>
			</ul>
		</nav>
	</footer>


<script>

function getParameterByName(name) {
	name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
	var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	results = regex.exec(location.search);
	return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}



function drawLine(latitude, longitude, miniRipple, map) {

	var lineCoordinates = [
		new google.maps.LatLng(latitude, longitude),
		new google.maps.LatLng(miniRipple["geoPoint"].latitude, miniRipple["geoPoint"].longitude)
	];

	var linePath = new google.maps.Polyline({
    path: lineCoordinates,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: 2,
    zIndex: 3
  });


  linePath.setMap(map);
}

function initialize(latitude, longitude, graph) {
  // Create the map.
  var mapOptions = {
    zoom: 4,
    center: new google.maps.LatLng(latitude, longitude),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  var map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  // Add the lines ------------------
  var frontier = [];

  for (var i = 0; i < graph.length; i++)
  {
  	var miniRipple = graph[i];
  	if (miniRipple["isFirstWave"])
  	{
  		frontier.push(miniRipple);
  		miniRipple["depth"] = 1;
  		drawLine(latitude, longitude, miniRipple, map);
  	}
  }

  while (frontier.length > 0)
  {
  	var miniRipple = frontier[0];
  	for (var i = 0; i < miniRipple["children"].length; i++)
  	{
  		var child = miniRipple["children"][i];
  		for (var j = 0; j < graph.length; j++)
  		{
  			var nextMiniRipple = graph[j];
  			if (child == nextMiniRipple["miniRippleId"])
  			{
  				frontier.push(nextMiniRipple);
  				nextMiniRipple.depth = miniRipple.depth + 1;
  				// TODO: if nextMiniRipple.deth > max -> Increase
  				drawLine(miniRipple["geoPoint"].latitude, miniRipple["geoPoint"].longitude, nextMiniRipple, map);
  				break;
  			}
  		}
  	}
  	frontier.splice(0,1);
  }

  // Add ripple ground zero
  var populationOptions = {
      strokeColor: '#FFAA3F',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FFAA3F',
      fillOpacity: 0.9,
      map: map,
      center: new google.maps.LatLng(latitude, longitude),
      radius: 100000,
      zIndex: 2
    };
    // Add the circle for this city to the map.
    cityCircle = new google.maps.Circle(populationOptions);



  // Construct the circle for each value in citymap.
  // Note: We scale the area of the circle based on the population.
  for (var i = 0; i < graph.length; i++) {
  	var miniRipple = graph[i];

    var populationOptions = {
      strokeColor: '#2B84DB',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#2B84DB',
      fillOpacity: 0.6,
      map: map,
      center: new google.maps.LatLng(miniRipple["geoPoint"].latitude, miniRipple["geoPoint"].longitude),
      radius: 100000,
      zIndex: 1
    };
    // Add the circle for this city to the map.
    cityCircle = new google.maps.Circle(populationOptions);
  }
}


$(document).ready(function() {

	Parse.initialize("NYPXQtFR0BBY0TEbfcpgn61l2IGHJXQkrY1bu8PM", "5CS8buPIcMHVrSIeJuzPNkrVpjQsy9l6D2bvw5Aw");



	setHeaderSize();

	

	var rippleId = getParameterByName('id');

	var Ripple = Parse.Object.extend("Ripple");
	var query = new Parse.Query(Ripple);
	query.get(rippleId, {
		success: function(ripple) {
			    // The object was retrieved successfully.
			    
			    $("#ripple_text").text(ripple.get("text"));
			    $("#ripple_image").attr("src", ripple.get("image").url());
			    $("#ripple_num_propagated").text("spread " + ripple.get("numPropagated") + " times");
			    $("#ripple_creator").text(ripple.get("creatorName"));
			    if (ripple.get("city"))
			    {
			    	if (ripple.get("state"))
			    		$("#ripple_location").text(ripple.get("city") + ", " + ripple.get("state"));
			    	else
			    		$("#ripple_location").text(ripple.get("city"));
			    }
			    
			    $("#ripple_created_at").text($.timeago(ripple.createdAt));

			    var geoPoint = ripple.get("startLocation");

			    Parse.Cloud.run('getMiniRipplesGraph', { rippleId: rippleId }, {
				  success: function(graph) {
				    google.maps.event.addDomListener(window, 'load', initialize(geoPoint.latitude, geoPoint.longitude, graph));
				  },
				  error: function(error) {
				  }
				});

			    


			},
			error: function(object, error) {
			    // The object was not retrieved successfully.
			    // error is a Parse.Error with an error code and message.
			    alert('error');
			}
		});		
});

$( window ).resize(function() {
	setHeaderSize();
});

function setHeaderSize()
{
			// set logo height and width
			$('.headerTitle').css({"background-color":"#0867ab","width":$(window).width()});
			$('.formIframe').css({"width":$(window).width(),"height":'1500px'});

			$("footer nav ul li ").css("font-family", "'Roboto', sans-serif");
			$("footer nav ul li ").css("margin-left", "10px");

			$('.ripple').css({"background":"#eee"});
			$('body').css({"background":"#eee"});
			$('.innerRipple').css({"background":"#fff"});

			if ($(window).width() < 500) 
			{
				$(".centerText").css("font-size", "20px");
				$(".centerSubtext").css("font-size", "10px");

				
				$("footer a").css("font-size", "12px");

			}
			else
			{
				$(".centerText").css("font-size", "60px");
				$(".centerSubtext").css("font-size", "20px");	

				//ios + android image
				$(".ios").css({"width":"180px", "float":"left"});
				$('.android').css({"width":"160px", "float":"right"});
				$('.actions').css({"height":"60px"});
				
				$("footer a").css("font-size", "15px");
				
			}
		}
		</script>
	</body>
	</html>