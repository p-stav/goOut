{% extends "base.html" %}

{% block title %}Kefi{% endblock %}

{% block content %}

<div class="placeList" id='match'>	
	
	{% for place in placeMatch %}
		
		<div class="venue" id="{{ place.id }}">
			<div align="right" class="venueInternalRight">
					{{place.distance}} mi
			</div>

			<div class="colorWrapper" style="background-color:rgb({{place.color}});" >
				
				<img class="venuePic"  src="{{place.picture}}"></img>
				<div class='venueTitle'>{{ place.name }}</div>
				<div class='venueType'>
					{{place.types}}
				</div>
				<br/>
			</div>

			

			<div class='venue-info curTag' style="color:rgb({{place.color}});">
				{% for tag in place.hashtags %}
					<span class='indexTag'>#{{ tag }}</span>
				{% endfor %}
			</div>

			<br/>
			

			
			<div class="separator">
			</div>
		</div>
	{% endfor %}

	{% for place in placeMatchOld %}
		<div class="venue" id="{{ place.id }}">
			<div align="right" class="venueInternalRight">
				{{place.distance}} mi
			</div>

			<div class="colorWrapper" style="background-color:rgb({{place.color}});" >
				<img class="venuePic"  src="{{place.picture}}"></img>
				<div class='venueTitle'>{{ place.name }}</div>
				<div class='venueType'>
					{{ place.types}}
						
				</div>
				<br/>
			</div>


			<div class='venue-info curTag' style="color:rgb({{place.color}});">
				Known For:<br/>
				{% for tag in place.hashtags %}
					<span class='indexTag'>#{{ tag }}</span>
				{% endfor %}
			</div>
			<br>

			<div class="separator">
			</div>
		</div>
	{% endfor %}
		
	<!--List for items with no data in our DB -->
	{% for place in placeNoMatch %}
		<div class="venue" id="{{ place.id }}">
			<div align="right" class="venueInternalRight">
				{{place.distance}} mi
			</div>

			<div class="colorWrapper" style="background-color:rgb({{place.color}});" >
				<img class="venuePic"  src="{{place.picture}}"></img>
				<div class='venueTitle'>{{ place.name }}</div>
				<div class='venueType'>
					{{place.types}}
				</div>
				<br/>
			</div>
			
			<div class='venue-info curTag' style="color:rgb({{place.color}});">
				<div>#NoTags!</div>
				<div class='noReviewsAddress'>
					Be the first to Tag!
					<br/><br/>
				</div>
			</div>
			
			<div class="separator">
			</div>
		</div>
	{% endfor %}
	
	<br/><br/><br/>
	<!--yelp button-->
	<!--<div class='right' style="width:100%; bottom:0px; float:right;"><img src="http://s3-media1.ak.yelpcdn.com/assets/2/www/img/1589098a542f/developers/Powered_By_Yelp_White.png"></div>-->
</div>

<!--modal-->
<div class="modal fade bs-example-modal-sm" id="tagModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content" style="font-family:'Roboto', sans-serif;">
			<div class="modal-header">
				Pick a tag to see matched venues!
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			</div>
			<div class="modal-body">
				{% for tag in tags %}
					<div class="tag inactiveTag" id="{{tag}}">#{{tag}}</div>
				{%endfor%}
			</div>
		</div>
	</div>
</div>


<script type = "text/javascript">

	$(document).ready(function() {
		$('.venue').click(function(){
			//link to next page. Search into how this interfaces with django
			location.href = './venue/'+$(this).attr('id');
		});


		$('.tag').click(function() {
			if ($(this).hasClass('inactiveTag'))
			{
				$(this).css('background-color','#c0c0c0');
				location.href='/tag/' + $(this).attr('id');
			}
		});
	});
/*
	if (navigator.geolocation) {
		// If so, get the current position and feed it to listPlaces
		navigator.geolocation.getCurrentPosition(listPlaces);
	}
	
	function listPlaces(position){
		var curLat = position.coords.latitude;
		var curLong = position.coords.longitude;
		
		//call for ALL venue types; CHANGE for current position
		apiCall = "https://maps.googleapis.com/maps/api/place/nearbysearch/json?location="+curLat+","+curLong+"&radius=550&types=bar|casino|night_club&sensor=true&key=AIzaSyAWf1WnMo_4s35yeXZ-kZyF-QZ7m5MwqP0";
		

	var callAPI = $.ajax({
			url: apiCall,
			//data: myData,
			type: 'GET',
			crossDomain: true,
			dataType: 'jsonp'
		})
			.done(function(objects){
				$.each(objects.results, function(index, data){
					$('.placeList').append("<div id='"+index+"'>"+data.name+" has a rating of: "+data.rating+"</div>");
					});
				console.log('call complete!');
			})
			
			.fail(function(){
				console.log('WHAT');
			});
			

		//EITHER THIS CALL OR THE ONE ABOVE IT
		var callAPI= $.getJSON(apiCall, function(json){
			console.log('grabbed json');
		})
			.done(function(json){
				$.each(json.results, function(index, data){
					$('.placeList').append("<div id='"+index+"'>"+data.name+" has a rating of: "+data.rating+"</div>");
					});
				console.log('call complete!');
			})
			
			.fail(function(){
				//console.log('WHAT');
			});
		callAPI.complete(function(){
			//console.log('second complete');
		});
		
	}
*/

</script>
{% endblock %}